@model List<Estudiante>

@{
    ViewData["Title"] = "Consulta de Saldo";
    Layout = null;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Consulta Saldo - Búsqueda</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="~/css/site.css" rel="stylesheet" />
</head>

<body class="admin-body">

    <div class="d-flex min-vh-100">

        <!-- SIDEBAR -->
        <nav class="admin-sidebar">
            <h4 class="sidebar-title">Wallet SICAI</h4>

            <ul class="nav flex-column mt-4">
                <li class="nav-item">
                    <a class="nav-link" asp-controller="Home" asp-action="Index">
                        <i class="fa-solid fa-house"></i> Menú Principal
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" asp-controller="DatosEstudiantes" asp-action="Buscar">
                        <i class="fa-solid fa-magnifying-glass"></i> Consulta de Saldo
                    </a>
                </li>
                <li class="nav-item" >
                    <a class="nav-link" asp-controller="RecargarSaldo" asp-action="Recargar">
                        <i class="fa-solid fa-wallet"></i> Recargar Saldo
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" asp-controller="RecargarSaldo" asp-action="Recargar">
                        <i class="fa-solid fa-wallet"></i> Recargar Saldo
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="fa-solid fa-calendar"></i> Historial General de Recargas
                    </a>
                </li>
            </ul>

            <div class="sidebar-bottom">
                <a class="nav-link"><i class="fa-solid fa-gear"></i> Settings</a>
                <a class="nav-link logout"><i class="fa-solid fa-right-from-bracket"></i> Log Out</a>
            </div>
        </nav>

        <!-- CONTENIDO -->
        <main class="admin-main flex-grow-1 p-5">

            <!-- TÍTULO -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-white mb-0">Consulta de Saldo – Búsqueda</h2>
                <a asp-controller="Home" asp-action="Index" class="btn btn-outline-light">
                    <i class="fa-solid fa-arrow-left me-2"></i> Volver al menú
                </a>
            </div>

            <!-- BUSCADOR -->
            <div class="search-card mb-5">
                <h5 class="text-white mb-3">Buscar Estudiante</h5>

                <form asp-action="Buscar" method="get">
                    <div class="input-group mb-3">
                        <span class="input-group-text bg-dark border-0 text-white">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </span>
                        <input type="text"
                               name="buscar"
                               class="form-control search-input"
                               placeholder="Ingrese la cédula o el nombre del estudiante"
                               required />
                    </div>

                    <button type="submit" class="btn btn-primary w-100">
                        Realizar consulta
                    </button>
                </form>
            </div>

            <!-- RESULTADOS -->
            @if (Context.Request.Query.ContainsKey("buscar"))
            {
                <div class="results-card">

                    <h5 class="text-white mb-3">Resultados de la Búsqueda</h5>

                    @if (Model != null && Model.Any())
                    {
                        foreach (var estudiante in Model)
                        {
                            <div class="result-item d-flex justify-content-between align-items-center mb-2">
                                <span class="text-primary">
                                    <strong>@estudiante.EstudianteCedula</strong>
                                    – @estudiante.EstudianteNombreCompleto
                                </span>

                                <button type="button"
                                        class="btn btn-sm btn-outline-info"
                                        onclick="mostrarEstudiante('@estudiante.EstudianteCedula')">
                                    <i class="fa-solid fa-eye me-1"></i> Ver detalles
                                </button>

                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-secondary text-center mb-0">
                            No se encontraron estudiantes con los valores ingresados.
                        </p>
                    }

                </div>
            }

            <!-- MODAL -->
            <div class="modal fade" id="estudianteModal" tabindex="-1">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content bg-dark text-white border-0 rounded-4 shadow-lg">

                        <!-- HEADER -->
                        <div class="modal-header border-0">
                            <h5 class="modal-title">
                                <i class="fa-solid fa-user-graduate me-2"></i>
                                Información del Estudiante
                            </h5>
                        </div>

                        <!-- BODY -->
                        <div class="modal-body" id="estudianteModalBody">
                            <div class="text-center py-5 text-secondary">
                                <i class="fa-solid fa-circle-info fa-3x mb-3"></i>
                                <p class="mb-0">Seleccione un estudiante para ver sus datos.</p>
                            </div>
                        </div>

                        <!-- FOOTER -->
                        <div class="modal-footer border-0 d-flex justify-content-end gap-2">

                            <!-- BOTÓN RECARGAR -->
                            <a id="btnRecargar" class="btn btn-secondary"> 
                                <i class="fa-solid fa-wallet me-2"></i> Recargar 
                             </a>
                            

                            <!-- BOTÓN CERRAR -->
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fa-solid fa-xmark me-2"></i>
                                Cerrar
                            </button>

                        </div>

                    </div>
                </div>
            </div>


        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function mostrarEstudiante(cedula) {
            // Llamar al controlador para obtener la vista parcial con los datos
            fetch('/DatosEstudiantes/Informacion?cedula=' + cedula)
                .then(r => r.text())
                .then(html => {
                    // Insertar los datos en el modal
                    document.getElementById('estudianteModalBody').innerHTML = html;

                    // Actualizar el botón de recarga con la cédula
                    const recargarBtn = document.getElementById('btnRecargar');
                    recargarBtn.href = `/RecargarSaldo/Recargar?cedula=${cedula}`;

                    // Mostrar el modal
                    new bootstrap.Modal(document.getElementById('estudianteModal')).show();
                });
        }
    </script>

</body>
</html>

